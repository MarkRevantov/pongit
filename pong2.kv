#:kivy 1.11.1
#:import cache kivy.cache
#:import SwapTransition kivy.uix.screenmanager.SwapTransition  
#:import SlideTransition kivy.uix.screenmanager.SlideTransition 
#:import RiseInTransition kivy.uix.screenmanager.RiseInTransition 
#:import FallOutTransition kivy.uix.screenmanager.FallOutTransition 

<MainMenuScreen>:
    canvas.before:
        Color:
            rgba: .5, .5, .5, 1
        Rectangle:
            source: 'Background/pong_bg.jpg'
            pos: self.pos
            size: self.size
    scale: (root.width+root.height)/(1280+720)

    btn_color: (.6, .6, .6, .82)
    normal_fnt_size: 56*root.scale
    main_l_fnt_size: 92*root.scale

    BoxLayout:
        size: root.size
        orientation: 'vertical'
        padding: root.width/4, root.width/17
        spacing: root.width/50


        Label:
            id: main_l
            font_size: root.main_l_fnt_size
            font_name: 'tahoma'
            text: 'Pong It!'

        Button:
            text: 'Play'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                root.btn_sound_play()
                root.manager.transition = RiseInTransition()
                root.manager.current = 'playing'
        Button:
            text: 'Settings'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                root.btn_sound_play()
                root.manager.transition = SlideTransition()
                root.manager.transition.direction = 'left'
                root.manager.current = 'settings'
        Button:
            text: 'Credits'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                root.btn_sound_play()
                root.manager.transition = SlideTransition()
                root.manager.transition.direction = 'right'
                root.manager.current = 'credits'
        Button:
            text: 'Exit'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                quit()
<SettingsScreen>:
    canvas.before:
        Color:
            rgba: .5, .5, .5, 1
        Rectangle:
            source: 'Background/pong_settings_bg.jpg'
            pos: self.pos
            size: self.size
    scale: (root.width+root.height)/(1280+720)

    btn_color: (.6, .6, .6, .82)
    normal_fnt_size: 46*root.scale
    main_l_fnt_size: 82*root.scale

    BoxLayout:
        size: root.size
        orientation: 'vertical'
        padding: root.width/8, root.height/20
        spacing: root.height/90

        # Settings!
        Label:
            id: main_l
            font_size: root.main_l_fnt_size
            font_name: 'tahoma'
            text: 'Settings!'

        # Count of Players
        Label:
            font_size: root.normal_fnt_size
            font_name: 'tahoma'
            text: 'Players'
        BoxLayout:
            spacing: root.width/80
            orientation: 'horizontal'
            ToggleButton:
                text: 'One Player'
                group: 'players'
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                on_release:
                    cache.Cache.append('settings', 'players', 1)
            ToggleButton:
                text: 'Two Players'
                group: 'players'
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                on_release:
                    cache.Cache.append('settings', 'players', 2)
        # Difficult level
        Label:
            font_size: root.normal_fnt_size
            font_name: 'tahoma'
            text: 'Diffucult'
        BoxLayout:
            spacing: root.width/80
            orientation: 'horizontal'
            ToggleButton:
                text: 'Usual'
                group: 'difficult'
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                on_release:
                    cache.Cache.append('settings', 'difficult', 1)
            ToggleButton:
                text: 'Hard'
                group: 'difficult'
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                on_release:
                    cache.Cache.append('settings', 'difficult', 2)
            ToggleButton:
                text: 'Impossible'
                group: 'difficult'
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                on_release:
                    print('impo')
                    cache.Cache.append('settings', 'difficult', 3)
        # Start ball velocity
        BoxLayout:
            spacing: root.width/80
            orientation: 'horizontal'
            Label:
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                text: 'Start ball velocity'
            TextInput:
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                text: '5'
                on_text:
                    cache.Cache.append('settings', 'start ball velocity', self.text)
        # Velocity increase multiple
        BoxLayout:
            spacing: root.width/80
            orientation: 'horizontal'
            Label:
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                text: 'Velocity multiple'
            TextInput:
                font_size: root.normal_fnt_size
                font_name: 'tahoma'
                text: '1.05'
                on_text:
                    cache.Cache.append('settings', 'velocity multiple', self.text)
        Button:
            text: 'Back'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                root.btn_sound_play()
                root.manager.transition = SlideTransition()
                root.manager.transition.direction = 'right'
                root.manager.current = 'main_menu'
<CreditsScreen>:
    canvas.before:
        Color:
            rgba: 1., 1., 1., 1
        Rectangle:
            source: 'Background/pong_credits_bg.jpg'
            pos: self.pos
            size: self.size
    scale: (root.width+root.height)/(1280+720)

    btn_color: (.6, .6, .6, .82)
    usual_fnt_size: 56*root.scale
    normal_fnt_size: 56*root.scale
    main_l_fnt_size: 92*root.scale

    BoxLayout:
        size: root.size
        orientation: 'vertical'
        padding: root.width/4, root.width/17
        spacing: root.width/50


        Label:
            id: main_l
            font_size: root.main_l_fnt_size
            font_name: 'tahoma'
            text: 'Credits!'
        Label:
            font_size: root.usual_fnt_size
            font_name: 'tahoma'
            text: 'Developer: Mikhail Gorokhov\nGithub: https://github.com/MarkRevantov\nversion: 1.0 (22sep2020)'
        Button:
            size_hint: 1,.5
            text: 'Back'
            background_normal: ''
            background_color: root.btn_color
            font_size: root.normal_fnt_size
            on_release:
                root.btn_sound_play()
                root.manager.transition = SlideTransition()
                root.manager.transition.direction = 'left'
                root.manager.current = 'main_menu'
<PongBoard>:
    size: 25, 200
    canvas:
        Rectangle:
            size: self.size
            pos: self.pos 

<PongBall>:
    size: 50, 50
    canvas:
        Ellipse:
            pos: self.pos
            size: self.size

<PlayingScreen>:
    size: root.size
    ball: pong_ball
    player1: player_left
    player2: player_right
    scale: (root.width+root.height)/(1280+720)

    GridLayout:
        canvas.before: 
            Rectangle:
                source: 'Background/pong_playing3_bg.png'
                pos: root.pos
                size: root.size

        canvas:
            #Center Line
            Rectangle:
                pos: root.width/2-6, 0
                size: 12, self.height
        # Points of Left Player
        Label:
            font_size: 70*root.scale
            center_x: root.width / 4
            top: root.top - 50
            text: str(root.player1.score)
        # Points of Right Player
        Label:
            font_size: 70*root.scale
            center_x: 3*root.width / 4
            top: root.top - 50
            text: str(root.player2.score)

        # а тут создаем экземпляр нашего шарика в игровом поле
        PongBall:
            id: pong_ball
            center: self.parent.center
        
        # Players - Left and Right
        PongBoard:
            id: player_left
            x: root.x
            center_y: root.center_y
        PongBoard:
            id: player_right
            x: root.width - self.width
            center_y: root.center_y
        Button:
            text: 'Back'
            size: 100*root.scale, 50*root.scale
            font_size: 32*root.scale
            center_x: root.width/2
            top: root.height
            on_release:
                root.btn_sound_play()
                root.manager.transition = FallOutTransition()
                root.manager.current = 'main_menu'